{% load static %}
<!doctype html>
<html lang="en" data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-direction="ltr" dir="ltr" data-pc-theme="light">
  <head>
    <title>Set New Password | TenSenses Factory</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <link rel="icon" href="{% static 'inventory/assets/images/favicon.svg' %}" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'inventory/assets/fonts/phosphor/duotone/style.css' %}" />
    <link rel="stylesheet" href="{% static 'inventory/assets/fonts/tabler-icons.min.css' %}" />
    <link rel="stylesheet" href="{% static 'inventory/assets/fonts/feather.css' %}" />
    <link rel="stylesheet" href="{% static 'inventory/assets/fonts/fontawesome.css' %}" />
    <link rel="stylesheet" href="{% static 'inventory/assets/fonts/material.css' %}" />
    <link rel="stylesheet" href="{% static 'inventory/assets/css/style.css' %}" id="main-style-link" />
    <style>
      /* Basic styling for auth pages - ensure these match your theme's style.css */
      .auth-main { background-color: var(--pc-theme, #f5f7fa); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
      .auth-wrapper { width: 100%; }
      .auth-form { background-color: var(--pc-theme, #f5f7fa); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem; }
      .card { border-radius: 10px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
      .card-body { padding: 2.5rem; }
      .form-group label { margin-bottom: .5rem; display: block; font-weight: 500; }
      .form-group input.form-control {
          width: 100%; padding: .75rem 1rem; font-size: 1rem; line-height: 1.5;
          color: #495057; background-color: #fff; border: 1px solid #ced4da; border-radius: .25rem;
          transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
      }
      .form-group input.form-control:focus {
          border-color: #80bdff; outline: 0; box-shadow: 0 0 0 .2rem rgba(0,123,255,.25);
      }
      .invalid-feedback {
          display: block; width: 100%; margin-top: .25rem; font-size: 87.5%; color: #dc3545;
      }
      .alert { padding: 1rem 1rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem; }
      .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
      .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
      .alert-info { color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb; }
      .d-grid { display: grid; gap: 1rem; }
      .btn-primary { background-color: #795548; border-color: #795548; color: #fff; }
      .btn-primary:hover { background-color: #5D4037; border-color: #5D4037; }
      .text-primary-500 { color: #5D4037; } /* Assuming this is your darker brown */
      .text-center { text-align: center; }
      .mb-4 { margin-bottom: 1.5rem; }
      .mb-8 { margin-bottom: 2.5rem; }
      .mt-4 { margin-top: 1.5rem; }
      .mx-auto { margin-left: auto; margin-right: auto; }
      .auth-logo { max-height: 40px; } /* Adjust as needed */
      .loader-bg { /* Ensure preloader styles are present */
        background: #EFEBE9;
        position: fixed;
        inset: 0;
        z-index: 1034;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .loader-track {
        height: 5px;
        width: 100%;
        overflow: hidden;
        position: absolute;
        top: 0;
      }
      .loader-fill {
        width: 300px;
        height: 5px;
        background: var(--primary, #795548);
        position: absolute;
        top: 0;
        left: 0;
        animation: hitZak 0.6s ease-in-out infinite alternate;
      }
      @keyframes hitZak {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
    </style>
  </head>
  <body>
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg fixed inset-0 bg-white dark:bg-themedark-cardbg z-[1034]">
      <div class="loader-track h-[5px] w-full inline-block absolute overflow-hidden top-0">
        <div class="loader-fill w-[300px] h-[5px] bg-primary-500 absolute top-0 left-0 animate-[hitZak_0.6s_ease-in-out_infinite_alternate]"></div>
      </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <div class="auth-main relative">
      <div class="auth-wrapper v1 flex items-center w-full h-full min-h-screen">
        <div class="auth-form flex items-center justify-center grow flex-col min-h-screen relative p-6 ">
          <div class="w-full max-w-[350px] relative">
            <div class="auth-bg ">
              <span class="absolute top-[-100px] right-[-100px] w-[300px] h-[300px] block rounded-full bg-theme-bg-1 animate-[floating_7s_infinite]"></span>
              <span class="absolute top-[150px] right-[-150px] w-5 h-5 block rounded-full bg-primary-500 animate-[floating_9s_infinite]"></span>
              <span class="absolute left-[-150px] bottom-[150px] w-5 h-5 block rounded-full bg-theme-bg-1 animate-[floating_7s_infinite]"></span>
              <span class="absolute left-[-100px] bottom-[-100px] w-[300px] h-[300px] block rounded-full bg-theme-bg-2 animate-[floating_9s_infinite]"></span>
            </div>
            <div class="card sm:my-12  w-full shadow-none">
              <div class="card-body !p-10">
                <div class="text-center mb-8">
                  <a href="{% url 'inventory_home' %}">
                    <img src="{% static 'inventory/assets/images/logo-dark.svg' %}" alt="TenSenses Logo" class="mx-auto auth-logo"/>
                  </a>
                </div>
                <h4 class="text-center font-medium mb-4">Set New Password</h4>

                {% if validlink %} {# Django passes 'validlink' to this template #}
                    <form method="post">
                        {% csrf_token %}
                        {# Display non-field errors (e.g., passwords don't match, or too weak) #}
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger" role="alert">
                                {% for error in form.non_field_errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}

                        {# Loop through form fields (usually new_password1, new_password2) #}
                        {% for field in form %}
                            <div class="mb-3 form-group">
                                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                                {{ field }}
                                {% if field.help_text %}
                                    <div class="form-text text-muted">{{ field.help_text }}</div>
                                {% endif %}
                                {% if field.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in field.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary mx-auto shadow-2xl">Set Password</button>
                        </div>
                    </form>
                {% else %} {# If the link is invalid or expired #}
                    <div class="alert alert-danger text-center" role="alert">
                        The password reset link was invalid, possibly because it has already been used.
                        Please request a new password reset.
                    </div>
                    <div class="flex justify-center items-end flex-wrap mt-4">
                        <a href="{% url 'password_reset' %}" class="text-primary-500">Request New Password Reset</a>
                    </div>
                {% endif %}

              </div>
            </div>
          </div>
        </div>
        <script src="{% static 'inventory/assets/js/plugins/simplebar.min.js' %}"></script>
        <script src="{% static 'inventory/assets/js/plugins/popper.min.js' %}"></script>
        <script src="{% static 'inventory/assets/js/icon/custom-icon.js' %}"></script>
        <script src="{% static 'inventory/assets/js/plugins/feather.min.js' %}"></script>
        <script src="{% static 'inventory/assets/js/component.js' %}"></script>
        <script src="{% static 'inventory/assets/js/theme.js' %}"></script>
        <script src="{% static 'inventory/assets/js/script.js' %}"></script>
      </body>
    </html>